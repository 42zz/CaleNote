# CaleNote - アプリ仕様書

## 1. 概要

### 1.1 アプリ名
**CaleNote**（Calendar + Note）

### 1.2 コンセプト
Googleカレンダーと連携した日記・ジャーナルアプリ。日々の記録を随時残しながら、カレンダーの予定と一緒に1日単位で振り返ることができる。過去の同じ日を振り返る機能で、自分の歩みを実感できる。

### 1.3 ターゲットユーザー
- 日々の出来事や思考を手軽に記録したい人
- Googleカレンダーで予定管理している人
- 後から振り返り・検索したい人

### 1.4 プラットフォーム
- iOS 17.0以上
- iPhone対応（iPad対応は将来検討）

---

## 2. 機能要件

### 2.1 ジャーナル機能（コア機能）

#### 2.1.1 エントリの構成要素

| 項目 | 必須 | 説明 |
|------|------|------|
| タイトル | 任意 | 短い見出し |
| 本文 | 必須 | メインのテキスト。ハッシュタグ対応 |
| 日時 | 自動 | 作成日時（手動変更可） |
| カラー | 任意 | カラーパレットから選択（デフォルト: ミュートブルー） |
| アイコン | 任意 | アイコンパレットから選択（デフォルト: なし） |
| 場所 | 任意 | 位置情報または手入力 |
| 写真 | 任意 | 複数枚添付可 |

#### 2.1.2 ハッシュタグ機能
- 本文内に `#タグ名` 形式で記述
- タグをタップで同一タグのエントリ一覧を表示（検索実行）

#### 2.1.3 位置情報
- 設定でデフォルト動作を選択可能
  - 「現在位置を自動取得」ON/OFF
- 個別エントリで位置を変更・削除可能
- 手入力で場所名を設定可能

#### 2.1.4 入力方法
**Phase 1（MVP）**
- アプリ内から手動入力
- 新規作成ボタン（FAB）

**Phase 2（将来）**
- ホーム画面ウィジェットから素早く入力

### 2.2 タイムライン表示

- **逆時系列**で表示（新しいエントリが上、古いものが下）
- Googleカレンダーの予定とジャーナルを統合表示
- **予定とジャーナルは完全に統一されたカードデザインで表示**（区別しない）
- カードの背景色はユーザーが選択したカラーパレットから適用
- カードのアイコンはユーザーが選択したアイコンパレットから適用
- 日付区切りを表示

### 2.3 カレンダー機能

- カレンダーボタンタップでカレンダーモーダル/シートを表示
- 月表示カレンダー
- **ジャーナルがある日にドットマーカー表示**
- 日付タップでその日のタイムライン位置にスクロール/遷移

### 2.4 Googleカレンダー連携

#### 2.4.1 認証
- Google Sign-In SDK使用
- Calendar API読み取り権限

#### 2.4.2 カレンダー選択
- 複数カレンダーから表示対象を選択
- カレンダーごとの表示ON/OFF

#### 2.4.3 予定の表示
- タイムライン上に予定を表示（参照のみ）
- 予定のカード背景色は、設定でカレンダーごとに選択したカラーパレットから適用
- 予定のカードアイコンは、設定でカレンダーごとに選択したアイコンパレットから適用

### 2.5 過去の同じ日を振り返り機能

- 今日と同じ月日の過去エントリを表示
- 「1年前」「5年前」「10年前」などの節目を強調
- タイムライン上部または専用セクションに表示

### 2.6 検索機能

- 画面上部に検索バー配置
- フリーテキスト検索（タイトル、本文、ハッシュタグ）
- 検索結果はタイムライン形式で表示

---

## 3. 画面構成

### 3.1 画面一覧（2タブ構成）

```
タブ1: メイン画面
├── 検索バー（上部）
├── カレンダーボタン
├── 過去の同じ日セクション
├── タイムライン（逆時系列）
└── 新規作成ボタン（FAB）

タブ2: 設定画面
├── Googleアカウント連携
├── カレンダー選択
├── 位置情報デフォルト設定
├── 表示設定
└── データ管理
```

### 3.2 画面詳細

#### 3.2.1 メイン画面

```
┌─────────────────────────────────┐
│  🔍 検索...              📅    │  ← 検索バー + カレンダーボタン
├─────────────────────────────────┤
│  ┌─────────────────────────┐   │
│  │ 📅 この日の思い出        │   │  ← 過去の同じ日（折りたたみ可）
│  │ 1年前: ○○へ旅行...      │   │
│  └─────────────────────────┘   │
├─────────────────────────────────┤
│  ── 2024年12月20日 ──          │  ← 日付区切り
│  ┌─────────────────────────┐   │
│  │ 📝 14:30               │   │  ← カード（統一デザイン）
│  │ ミーティングメモ        │   │
│  │ 今日の打ち合わせで...    │   │
│  └─────────────────────────┘   │
│  ┌─────────────────────────┐   │
│  │ 📅 13:00-14:00         │   │  ← カード（統一デザイン）
│  │ チームMTG              │   │
│  └─────────────────────────┘   │
│  ┌─────────────────────────┐   │
│  │ 💡 10:15               │   │  ← カード（統一デザイン）
│  │ アイデア               │   │
│  │ 新機能について #仕事    │   │
│  └─────────────────────────┘   │
│                                 │
│  ── 2024年12月19日 ──          │
│  ...                            │
│                                 │
│                          [＋]   │  ← FAB（新規作成）
├─────────────────────────────────┤
│    [メイン]      [設定]         │  ← タブバー
└─────────────────────────────────┘
```

**構成要素**:
- 検索バー（上部固定）
- カレンダーボタン（検索バー右端）
- 過去の同じ日セクション（折りたたみ可能）
- タイムライン（逆時系列、日付区切りあり）
- 新規作成FAB（右下固定）

**インタラクション**:
- 検索バータップ → キーボード表示、検索実行
- カレンダーボタンタップ → カレンダーシート表示
- 予定カードタップ → 予定詳細（読み取りのみ）
- ジャーナルカードタップ → 編集画面
- 過去エントリタップ → 該当日へスクロール
- FABタップ → 新規作成画面
- 下スクロール → 過去のエントリを読み込み

**カードの統一**:
- **予定とジャーナルは完全に統一されたカードデザインを使用**（視覚的な区別は行わない）
- カードの背景色は、カラーパレットから選択した色を適用
- カードのアイコンは、アイコンパレットから選択したアイコンを適用
- ジャーナルエントリ作成時: カラーとアイコンを選択可能
- 予定表示時: 設定でカレンダーごとに選択したカラーとアイコンを適用

#### 3.2.2 カレンダーシート（モーダル）

```
┌─────────────────────────────────┐
│         2024年12月         ▼   │
├─────────────────────────────────┤
│  日  月  火  水  木  金  土    │
│                              1 │
│   2   3   4   5●  6   7   8  │  ← ●はジャーナル記録日
│   9  10  11● 12  13  14  15  │
│  16  17  18  19● 20◉ 21  22  │  ← ◉は今日
│  23  24  25  26  27  28  29  │
│  30  31                       │
└─────────────────────────────────┘
```

**インタラクション**:
- 日付タップ → シート閉じる → その日のタイムラインへ遷移
- 月スワイプ → 前後の月へ移動
- 外側タップ → シート閉じる

#### 3.2.3 ジャーナル作成/編集画面（モーダル）

```
┌─────────────────────────────────┐
│  ✕ 新規エントリ        保存    │
├─────────────────────────────────┤
│  タイトル（任意）              │
│  ─────────────────────────     │
│                                 │
│  今日あったこと...              │
│                                 │
│                                 │
│                                 │
├─────────────────────────────────┤
│  🎨 カラー: ミュートブルー  ▼  │
│  🎯 アイコン: 📝            ▼  │
│  📍 渋谷区（現在地）      ✕    │
│  📷 写真を追加                  │
│  🕐 2024/12/20 14:30     変更  │
└─────────────────────────────────┘
```

**構成要素**:
- 閉じるボタン（左上）
- 保存ボタン（右上）
- タイトル入力欄
- 本文入力欄
- カラー選択（カラーパレットから選択、デフォルト: ミュートブルー）
- アイコン選択（アイコンパレットから選択、デフォルト: なし）
- 場所（デフォルト設定に応じて自動入力）
- 写真追加ボタン
- 日時表示/変更

#### 3.2.4 設定画面

```
┌─────────────────────────────────┐
│           設定                  │
├─────────────────────────────────┤
│  アカウント                     │
│  ┌─────────────────────────┐   │
│  │ Google連携    user@gmail│   │
│  └─────────────────────────┘   │
├─────────────────────────────────┤
│  カレンダー                     │
│  ┌─────────────────────────┐   │
│  │ 表示するカレンダー    ＞ │   │
│  │ カレンダーの色・アイコン ＞ │   │
│  └─────────────────────────┘   │
├─────────────────────────────────┤
│  ジャーナル                     │
│  ┌─────────────────────────┐   │
│  │ 現在地を自動取得   [ON] │   │
│  └─────────────────────────┘   │
├─────────────────────────────────┤
│  表示                           │
│  ┌─────────────────────────┐   │
│  │ テーマ          システム│   │
│  └─────────────────────────┘   │
├─────────────────────────────────┤
│  データ                         │
│  ┌─────────────────────────┐   │
│  │ エクスポート          ＞ │   │
│  │ バックアップ          ＞ │   │
│  └─────────────────────────┘   │
├─────────────────────────────────┤
│    [メイン]      [設定]         │
└─────────────────────────────────┘
```

---

## 4. データモデル

### 4.1 JournalEntry（SwiftData）

```swift
@Model
class JournalEntry {
    var id: UUID
    var title: String?
    var content: String
    var createdAt: Date
    var updatedAt: Date
    var location: Location?
    var photos: [PhotoData]
    var selectedColorId: String?  // カラーパレットから選択した色のID
    var selectedIconId: String?   // アイコンパレットから選択したアイコンのID
    
    // ハッシュタグは本文から都度抽出
    var extractedTags: [String] {
        // #で始まる単語を抽出するcomputed property
    }
}
```

### 4.2 Location

```swift
struct Location: Codable {
    var name: String?
    var address: String?
    var latitude: Double?
    var longitude: Double?
}
```

### 4.3 PhotoData

```swift
@Model
class PhotoData {
    var id: UUID
    var imageData: Data
    var createdAt: Date
}
```

### 4.4 GoogleCalendarEvent（APIレスポンス）

```swift
struct GoogleCalendarEvent: Identifiable {
    var id: String
    var title: String
    var startTime: Date
    var endTime: Date
    var calendarId: String
    var calendarColor: String
}
```

### 4.5 AppSettings（UserDefaults）

```swift
struct AppSettings {
    var useCurrentLocationByDefault: Bool  // 位置情報デフォルト設定
    var selectedCalendarIds: [String]      // 表示するカレンダー
    var calendarColorMap: [String: String]  // カレンダーID → カラーパレットIDのマッピング
    var calendarIconMap: [String: String]   // カレンダーID → アイコンパレットIDのマッピング
    var theme: AppTheme                    // ライト/ダーク/システム
}
```

---

## 5. 技術スタック

| レイヤー | 技術 |
|----------|------|
| 言語 | Swift 5.9+ |
| UIフレームワーク | SwiftUI |
| データ永続化 | SwiftData |
| 認証 | Google Sign-In SDK |
| カレンダーAPI | Google Calendar API (REST) |
| 位置情報 | CoreLocation |
| 写真 | PhotosUI (PhotosPicker) |
| 将来: 同期 | CloudKit |

---

## 6. 開発フェーズ

### Phase 1: MVP（4-6週間）
**目標**: 基本的なジャーナル機能が動作する

- [ ] プロジェクトセットアップ
- [ ] SwiftDataモデル定義
- [ ] メイン画面（タイムライン表示）
- [ ] ジャーナル作成/編集画面
- [ ] カレンダーシート（日付選択、記録日ドット表示）
- [ ] 基本的な検索機能
- [ ] ハッシュタグ抽出・タップで検索
- [ ] 設定画面（基本項目）

### Phase 2: Googleカレンダー連携（2-3週間）
**目標**: カレンダーの予定を表示できる

- [ ] Google Sign-In実装
- [ ] Calendar API連携
- [ ] 予定の取得・表示
- [ ] 予定とジャーナルの統合タイムライン

### Phase 3: 拡張機能（2-3週間）
**目標**: 使いやすさ向上

- [ ] カラー・アイコン選択機能（カラーパレット・アイコンパレット実装）
- [ ] 場所情報の追加（デフォルト設定含む）
- [ ] 写真添付機能
- [ ] **過去の同じ日を振り返り機能**
- [ ] ダークモード対応

### Phase 4: 公開準備（2週間）
**目標**: App Store申請

- [ ] アプリアイコン・スクリーンショット
- [ ] プライバシーポリシー作成
- [ ] App Store Connect設定
- [ ] TestFlight配布
- [ ] 審査申請

### Phase 5: 将来の拡張（公開後）
- [ ] ウィジェット対応
- [ ] CloudKit同期
- [ ] iPad対応

---

## 7. UI/UXガイドライン

### 7.1 デザイン原則（変更なし）

- **シンプル**: 2タブ構成、必要最小限の要素
- **モダン**: iOS標準に準拠しつつ洗練されたデザイン
- **高速**: 入力から保存まで最短ステップ
- **文章が主役で、UIは邪魔をしないこと**

---

### 7.2 カラースキーマ（更新）

本アプリは **初期リリースではライトモードのみをサポート** する。
ダークモード対応は将来フェーズで検討する。

#### 7.2.1 ベースカラー（ライトモード）

| 要素 | カラーコード | 備考 |
|------|-------------|------|
| 背景 | #FAFAFA | 純白を避け、長文閲覧時の疲労を軽減 |
| メインテキスト | #1F1F1F | 高コントラスト |
| サブテキスト | rgba(31,31,31,0.6) | 補足情報用 |
| セパレーター | rgba(0,0,0,0.08) | 目立たせない |

---

#### 7.2.2 カードの基本デザイン

**予定とジャーナルは完全に統一されたカードデザインを使用する**（視覚的な区別は行わない）。

カードの背景色とアイコンは、ユーザーがパレットから選択したものを適用する。

- ジャーナルエントリ作成時: カラーパレットとアイコンパレットから選択可能
  - カラー: デフォルト: ミュートブルー #E3F2FD
  - アイコン: デフォルト: なし
- 予定表示時: 設定でカレンダーごとに選択したカラーとアイコンを適用
  - カラー: デフォルト: ミュートブルー #E3F2FD
  - アイコン: デフォルト: 📅

---

#### 7.2.3 アクセントカラー

| 要素 | カラーコード |
|------|-------------|
| アクセント | #4CAF50 |

使用箇所は以下に限定する。

- 新規作成ボタン（FAB）
- 選択中の日付
- トグルON状態
- リンク的テキスト

---

### 7.3 カレンダー別カラー設定（新規追加）

#### 7.3.1 概要

Googleカレンダーごとに、ユーザーが表示色を選択できる機能を提供する。
色はアプリ側で用意した **デフォルトカラーパレットから選択** する方式とする。

自由入力型のカラーピッカーは提供しない。

---

#### 7.3.2 デフォルトカラーパレット（ライトモード）

| 名称 | カラーコード | 想定用途 |
|------|-------------|---------|
| ミュートブルー | #E3F2FD | 仕事 / 共通 |
| ミュートグリーン | #E8F5E9 | 健康 / 習慣 |
| セージ | #EEF3F1 | 家族 / 私用 |
| サンドベージュ | #F5F1EC | 生活 / 雑多 |
| ミュートオレンジ | #FBE9E7 | 外出 / イベント |
| ダスティーレッド | #F3E5E5 | 期限 / 重要 |
| ラベンダーグレー | #F1EEF6 | 学習 / 趣味 |
| スレートグレー | #ECEFF1 | 色を付けたくない場合 |

---

#### 7.3.3 タイムラインでのカラーとアイコンの扱い

- カレンダー色はカードの背景色として適用する
- カレンダーアイコンはカードのアイコンとして適用する
- ジャーナルエントリにもカラーパレットとアイコンパレットから選択可能
- 同一色・同一アイコンを複数カレンダーやジャーナルエントリで選択可能とする
- **予定とジャーナルは視覚的に区別しない**（完全に統一されたカードデザイン）

---

#### 7.3.4 アイコンパレット

カードに表示するアイコンは、以下のアイコンパレットから選択する。

| アイコン | 名称 | 想定用途 |
|---------|------|---------|
| 📝 | メモ | 一般的な記録 |
| 📅 | カレンダー | 予定・イベント |
| 💡 | アイデア | 思いつき・発想 |
| 🎯 | 目標 | 目標・タスク |
| ❤️ | 感情 | 感情・思い出 |
| 🍽️ | 食事 | 食事・料理 |
| 🏃 | 運動 | 運動・健康 |
| 📚 | 学習 | 勉強・読書 |
| 🎨 | 創作 | 創作活動 |
| 🎵 | 音楽 | 音楽・エンタメ |
| 🚗 | 移動 | 旅行・移動 |
| 💼 | 仕事 | 仕事・ビジネス |
| 🏠 | 家 | 家庭・プライベート |
| 🌟 | 星 | 特別な日 |
| （なし） | なし | アイコンを表示しない |

---

### 7.4 カレンダー画面の配色ルール（補足）

- ジャーナルあり日付: アクセントカラーのドット
- 今日の日付: アクセントカラーで塗りつぶし
- 選択中の日付: アクセントカラーの枠線
- それ以外の日付: グレー系テキスト

---

### 7.5 タイポグラフィ

#### 7.5.1 フォント設定

| 言語 | フォント | 用途 |
|------|---------|------|
| 日本語 | Noto Sans JP | すべての日本語テキスト |
| 英数字 | Inter | すべての英数字テキスト |

#### 7.5.2 フォントサイズ

- タイトル: 18pt（セミボールド）
- 本文: 16pt（レギュラー）
- サブテキスト（日時、場所など）: 14pt（レギュラー）
- キャプション: 12pt（レギュラー）

---

## 8. 非機能要件

### 8.1 パフォーマンス
- アプリ起動: 2秒以内
- ジャーナル保存: 即座
- カレンダー読み込み: 3秒以内
- 過去の同じ日検索: 1秒以内
- タイムラインスクロール: 60fps維持

### 8.2 セキュリティ
- Google認証トークンはKeychainに保存
- ローカルデータは端末内に保存（Phase 1）

### 8.3 プライバシー
- 位置情報は許可制
- 写真アクセスは許可制
- 分析データは収集しない（Phase 1）

---

## 9. 制約・前提条件

- iOS 17以上必須（SwiftData使用のため）
- Googleアカウント必須（カレンダー連携時）
- ネットワーク必須（カレンダー同期時）
- オフライン時はジャーナル機能のみ利用可

---

## 10. 用語集

| 用語 | 説明 |
|------|------|
| エントリ | 1つのジャーナル記録 |
| タイムライン | 逆時系列で並んだエントリと予定の一覧 |
| タグ | ハッシュタグ形式のラベル（#仕事、#アイデア等） |
| 過去の同じ日 | 今日と同じ月日の過去年のエントリ |

---

## 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2024-12-20 | 0.1 | 初版作成 |
| 2024-12-20 | 0.2 | アプリ名変更、各種機能調整 |
| 2024-12-20 | 0.3 | 2タブ構成に簡素化、タイムラインベースのメイン画面に変更 |
| 2024-12-20 | 0.4 | ジャーナルカードと予定カードを統一、フォント設定追加（Noto Sans JP / Inter） |
| 2024-12-20 | 0.5 | カードのカラーとアイコン選択機能を追加、予定・ジャーナルの完全統一を明確化 |
